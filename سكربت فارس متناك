-- Ø£Ù‚ÙˆÙ‰ Ø³ÙƒØ±Ø¨Øª Ù…ØªÙ‚Ø¯Ù… Ø¬Ø¯Ù‹Ø§ Ù„ØªÙ‚Ù„ÙŠÙ„ Lag + Auto Optimization
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local UserSettings = UserSettings()
local RenderSettings = UserSettings:GetService("UserGameSettings")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- =====================
-- 1ï¸âƒ£ ØªØ­Ø¯ÙŠØ¯ Ù‚ÙˆØ© Ø§Ù„Ø¬Ù‡Ø§Ø² ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
-- =====================
local function getDevicePerformance()
    local perf = UserSettings.PerformanceQualityLevel
    -- perf: 1 = Ù…Ù†Ø®ÙØ¶ØŒ 2 = Ù…ØªÙˆØ³Ø·ØŒ 3 = Ø¹Ø§Ù„ÙŠ
    return perf or 1
end

local devicePerf = getDevicePerformance()

-- =====================
-- 2ï¸âƒ£ Ø¶Ø¨Ø· Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ§Øª Ø­Ø³Ø¨ Ù‚ÙˆØ© Ø§Ù„Ø¬Ù‡Ø§Ø²
-- =====================
if devicePerf == 1 then
    RenderSettings.GraphicsQualityLevel = 1
    RenderSettings.SavedQualityLevel = 1
elseif devicePerf == 2 then
    RenderSettings.GraphicsQualityLevel = 2
    RenderSettings.SavedQualityLevel = 2
else
    RenderSettings.GraphicsQualityLevel = 3
    RenderSettings.SavedQualityLevel = 3
end

-- =====================
-- 3ï¸âƒ£ ØªØ¹Ø·ÙŠÙ„ Effects Ø«Ù‚ÙŠÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
-- =====================
Lighting.GlobalShadows = false
Lighting.FogEnd = 100000
Lighting.Brightness = 2
Lighting.Ambient = Color3.fromRGB(200,200,200)
Lighting.OutdoorAmbient = Color3.fromRGB(180,180,180)

for _, effect in pairs(Lighting:GetChildren()) do
    if effect:IsA("BlurEffect") or effect:IsA("DepthOfFieldEffect") or effect:IsA("SunRaysEffect") then
        effect.Enabled = false
    end
end

-- =====================
-- 4ï¸âƒ£ ØªØ¹Ø·ÙŠÙ„ ÙƒÙ„ Particle / Trail / Smoke / Fire / Explosion
-- =====================
local function disableEffects(parent)
    for _, obj in pairs(parent:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") then
            obj.Enabled = false
        elseif obj:IsA("Explosion") then
            obj.BlastPressure = 0
            obj.BlastRadius = 0
        end
    end
end

disableEffects(Workspace)
RunService.Heartbeat:Connect(function()
    disableEffects(Workspace)
end)

-- =====================
-- 5ï¸âƒ£ Dynamic FPS Limiter Ø°ÙƒÙŠ
-- =====================
local targetFPS = devicePerf == 1 and 30 or (devicePerf == 2 and 45 or 60)
local frameTime = 1 / targetFPS
local lastFrame = tick()

RunService.RenderStepped:Connect(function()
    local now = tick()
    local dt = now - lastFrame
    if dt < frameTime then
        wait(frameTime - dt)
    end
    lastFrame = tick()
end)

-- =====================
-- 6ï¸âƒ£ LOD Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø©
-- =====================
local LOD_DISTANCE = devicePerf == 1 and 100 or (devicePerf == 2 and 200 or 300)

RunService.Heartbeat:Connect(function()
    local camPos = camera.CFrame.Position
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            local distance = (obj.Position - camPos).Magnitude
            if distance > LOD_DISTANCE then
                obj.Transparency = 1
                obj.CanCollide = false
            else
                obj.Transparency = 0
                obj.CanCollide = true
            end
        end
    end
end)

-- =====================
-- 7ï¸âƒ£ ØªØ­Ø³ÙŠÙ† Meshes ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
-- =====================
for _, mesh in pairs(Workspace:GetDescendants()) do
    if mesh:IsA("SpecialMesh") or mesh:IsA("MeshPart") then
        mesh.LevelOfDetail = devicePerf == 1 and 1 or (devicePerf == 2 and 2 or 3)
    end
end

-- =====================
-- 8ï¸âƒ£ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
-- =====================
print("ğŸ”¥ Ø£Ù‚ÙˆÙ‰ Ø³ÙƒØ±Ø¨Øª Ù…ØªÙ‚Ø¯Ù… Ù„ØªÙ‚Ù„ÙŠÙ„ Lag Ù…ÙØ¹Ù„! Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù…Ø­Ø³Ù‘Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨.")
